# LINE Bot æ™ºèƒ½æ–‡ä»¶åŠ©æ‰‹ ğŸ“š

> ä¸€å€‹çµåˆ LINE Bot èˆ‡ Google Gemini File Search çš„æ™ºèƒ½æ–‡ä»¶å•ç­”æ©Ÿå™¨äºº

## ğŸ¯ é€™æ˜¯ä»€éº¼ï¼Ÿ

æƒ³åƒä¸€ä¸‹ï¼šä½ å¯ä»¥æŠŠä»»ä½• PDFã€Word æ–‡ä»¶ã€åœ–ç‰‡å‚³çµ¦ LINE Botï¼Œç„¶å¾Œç›´æ¥å•å®ƒã€Œé€™ä»½æ–‡ä»¶åœ¨è¬›ä»€éº¼ï¼Ÿã€ã€ã€Œå¹«æˆ‘æ•´ç†é‡é»ã€ã€ã€Œé€™å¼µåœ–ç‰‡è£¡æœ‰ä»€éº¼ï¼Ÿã€ï¼ŒBot å°±æœƒç”¨ AI å¹«ä½ åˆ†æä¸¦å›ç­”ï¼

é€™å€‹å°ˆæ¡ˆè®“ä½ è¼•é¬†æ‰“é€ ä¸€å€‹å°ˆå±¬çš„æ–‡ä»¶æ™ºèƒ½åŠ©æ‰‹ï¼Œåªè¦ï¼š
1. ğŸ“¤ å‚³é€æ–‡ä»¶æˆ–åœ–ç‰‡çµ¦ Bot
2. ğŸ’¬ ç”¨è‡ªç„¶èªè¨€æå•
3. ğŸ¤– AI ç«‹å³åˆ†æä¸¦å›ç­”

## âœ¨ åŠŸèƒ½ç‰¹è‰²

### ğŸ“ æ”¯æ´å¤šç¨®æª”æ¡ˆæ ¼å¼
- ğŸ“„ æ–‡ä»¶æª”æ¡ˆï¼šPDFã€Word (DOCX)ã€ç´”æ–‡å­— (TXT) ç­‰
- ğŸ–¼ï¸ åœ–ç‰‡æª”æ¡ˆï¼šJPGã€PNG ç­‰ï¼ˆå¯ä»¥åˆ†æåœ–ç‰‡å…§å®¹ï¼ï¼‰
- ğŸ”„ è‡ªå‹•ä¸Šå‚³ä¸¦ç®¡ç†æª”æ¡ˆ

### ğŸ§  AI æ™ºèƒ½å•ç­”
- ä½¿ç”¨ Google Gemini 2.5 Flash æ¨¡å‹
- åŸºæ–¼ä½ ä¸Šå‚³çš„æ–‡ä»¶å…§å®¹å›ç­”å•é¡Œ
- æ”¯æ´ç¹é«”ä¸­æ–‡ã€è‹±æ–‡ç­‰å¤šèªè¨€

### ğŸ‘¥ å¤šäººå”ä½œæ”¯æ´
- **1 å° 1 èŠå¤©**ï¼šæ¯å€‹äººæœ‰è‡ªå·±çš„æ–‡ä»¶åº«ï¼ˆéš”é›¢çš„ï¼‰
- **ç¾¤çµ„èŠå¤©**ï¼šç¾¤çµ„æˆå“¡å…±äº«æ–‡ä»¶åº«ï¼ˆå¤§å®¶éƒ½èƒ½æŸ¥è©¢ï¼‰
- è‡ªå‹•è­˜åˆ¥å°è©±é¡å‹ï¼Œç„¡éœ€æ‰‹å‹•è¨­å®š

### ğŸš€ éƒ¨ç½²ç°¡å–®
- æ”¯æ´ Docker å®¹å™¨åŒ–éƒ¨ç½²
- å¯éƒ¨ç½²åˆ° Google Cloud Run
- æˆ–åœ¨æœ¬åœ°é–‹ç™¼æ¸¬è©¦

## ğŸ“¸ ä½¿ç”¨ç¯„ä¾‹

```
ğŸ‘¤ ä½ : [ä¸Šå‚³ä¸€ä»½æœƒè­°è¨˜éŒ„.pdf]
ğŸ¤– Bot: âœ… æª”æ¡ˆå·²æˆåŠŸä¸Šå‚³ï¼
       æª”æ¡ˆåç¨±ï¼šæœƒè­°è¨˜éŒ„.pdf

       ç¾åœ¨æ‚¨å¯ä»¥è©¢å•æˆ‘é—œæ–¼é€™å€‹æª”æ¡ˆçš„ä»»ä½•å•é¡Œã€‚

ğŸ‘¤ ä½ : é€™æ¬¡æœƒè­°çš„ä¸»è¦æ±ºè­°æ˜¯ä»€éº¼ï¼Ÿ
ğŸ¤– Bot: æ ¹æ“šæœƒè­°è¨˜éŒ„ï¼Œä¸»è¦æ±ºè­°åŒ…æ‹¬ï¼š
       1. ä¸‹å­£åº¦é ç®—å¢åŠ  15%
       2. æ–°ç”¢å“é è¨ˆ 6 æœˆä¸Šå¸‚
       3. äººåŠ›è³‡æºéƒ¨é–€å°‡æ“´ç·¨ 3 åå“¡å·¥
       ...
```

## ğŸ› ï¸ æŠ€è¡“æ¶æ§‹

- **Python 3.9+**
- **FastAPI** - é«˜æ•ˆèƒ½ç•°æ­¥ Web æ¡†æ¶
- **LINE Messaging API** - LINE Bot ä»‹é¢
- **Google Gemini API** - æ–‡ä»¶æœå°‹èˆ‡ AI å•ç­”
- **Docker** - å®¹å™¨åŒ–éƒ¨ç½²

## ğŸ“¦ å¿«é€Ÿé–‹å§‹

### 1ï¸âƒ£ ç’°å¢ƒæº–å‚™

é¦–å…ˆï¼Œä½ éœ€è¦æº–å‚™é€™äº›ï¼š

**LINE Bot è¨­å®š**
1. åˆ° [LINE Developers Console](https://developers.line.biz/console/) å»ºç«‹ä¸€å€‹ Messaging API channel
2. å–å¾—ä½ çš„ `Channel Secret` å’Œ `Channel Access Token`

**Google Gemini API**
1. åˆ° [Google AI Studio](https://aistudio.google.com/app/apikey) å»ºç«‹ API Key
2. è¤‡è£½ä½ çš„ `API Key`

### 2ï¸âƒ£ ä¸‹è¼‰å°ˆæ¡ˆ

```bash
git clone <ä½ çš„ repo URL>
cd linebot-file-search-adk
```

### 3ï¸âƒ£ å®‰è£å¥—ä»¶

```bash
pip install -r requirements.txt
```

### 4ï¸âƒ£ è¨­å®šç’°å¢ƒè®Šæ•¸

å»ºç«‹ `.env` æª”æ¡ˆæˆ–ç›´æ¥è¨­å®šç’°å¢ƒè®Šæ•¸ï¼š

```bash
export ChannelSecret="ä½ çš„ LINE Channel Secret"
export ChannelAccessToken="ä½ çš„ LINE Channel Access Token"
export GOOGLE_API_KEY="ä½ çš„ Google Gemini API Key"
```

### 5ï¸âƒ£ å•Ÿå‹•æœå‹™

```bash
uvicorn main:app --reload
```

æœå‹™æœƒåœ¨ `http://localhost:8000` å•Ÿå‹•

### 6ï¸âƒ£ è¨­å®š Webhook

å¦‚æœåœ¨æœ¬åœ°é–‹ç™¼ï¼Œä½¿ç”¨ ngrok ä¾†å»ºç«‹å…¬é–‹çš„ç¶²å€ï¼š

```bash
ngrok http 8000
```

ç„¶å¾Œåˆ° LINE Developers Consoleï¼ŒæŠŠ Webhook URL è¨­å®šç‚ºï¼š
```
https://ä½ çš„-ngrok-ç¶²å€.ngrok.io/
```

## ğŸ® ä½¿ç”¨æ–¹å¼

### ğŸ“¤ ä¸Šå‚³æª”æ¡ˆ

1. ç›´æ¥åœ¨ LINE èŠå¤©å®¤å‚³é€æª”æ¡ˆæˆ–åœ–ç‰‡
2. Bot æœƒå›è¦†ã€Œæ­£åœ¨è™•ç†æ‚¨çš„æª”æ¡ˆï¼Œè«‹ç¨å€™...ã€
3. ä¸Šå‚³å®Œæˆå¾Œæœƒé¡¯ç¤ºã€Œâœ… æª”æ¡ˆå·²æˆåŠŸä¸Šå‚³ï¼ã€

### ğŸ’¬ é–‹å§‹æå•

ä¸Šå‚³æª”æ¡ˆå¾Œï¼Œä½ å¯ä»¥å•ä»»ä½•ç›¸é—œå•é¡Œï¼š

- ã€Œé€™ä»½æ–‡ä»¶çš„é‡é»æ˜¯ä»€éº¼ï¼Ÿã€
- ã€Œå¹«æˆ‘æ•´ç†æˆæ¢åˆ—å¼ã€
- ã€Œç¬¬ä¸‰ç« åœ¨è¬›ä»€éº¼ï¼Ÿã€
- ã€Œé€™å¼µåœ–ç‰‡è£¡æœ‰å“ªäº›ç‰©å“ï¼Ÿã€
- ã€Œæ ¹æ“šé€™ä»½å ±å‘Šï¼Œæˆ‘å€‘æ‡‰è©²æ³¨æ„ä»€éº¼ï¼Ÿã€

### ğŸ“ æª”æ¡ˆç®¡ç†æ–¹å¼

- **å€‹äººèŠå¤©**ï¼šæ¯å€‹äººæœ‰ç¨ç«‹çš„æ–‡ä»¶åº«ï¼Œåªèƒ½æŸ¥è©¢è‡ªå·±ä¸Šå‚³çš„æª”æ¡ˆ
- **ç¾¤çµ„èŠå¤©**ï¼šæ‰€æœ‰ç¾¤çµ„æˆå“¡å…±äº«åŒä¸€å€‹æ–‡ä»¶åº«ï¼Œä»»ä½•äººä¸Šå‚³çš„æª”æ¡ˆéƒ½èƒ½è¢«æŸ¥è©¢

## ğŸ³ Docker éƒ¨ç½²

### å»ºç«‹æ˜ åƒæª”

```bash
docker build -t linebot-file-search .
```

### å•Ÿå‹•å®¹å™¨

```bash
docker run -p 8000:8000 \
  -e ChannelSecret=ä½ çš„SECRET \
  -e ChannelAccessToken=ä½ çš„TOKEN \
  -e GOOGLE_API_KEY=ä½ çš„API_KEY \
  linebot-file-search
```

## â˜ï¸ éƒ¨ç½²åˆ° Google Cloud Run

### æ­¥é©Ÿ 1ï¼šå®‰è£ Google Cloud SDK

åƒè€ƒ[å®˜æ–¹æ–‡ä»¶](https://cloud.google.com/sdk/docs/install)å®‰è£

### æ­¥é©Ÿ 2ï¼šç™»å…¥ä¸¦è¨­å®šå°ˆæ¡ˆ

```bash
gcloud auth login
gcloud config set project ä½ çš„å°ˆæ¡ˆID
```

### æ­¥é©Ÿ 3ï¼šå»ºç«‹ä¸¦ä¸Šå‚³ Docker æ˜ åƒ

```bash
gcloud builds submit --tag gcr.io/ä½ çš„å°ˆæ¡ˆID/linebot-file-search
```

### æ­¥é©Ÿ 4ï¼šéƒ¨ç½²åˆ° Cloud Run

```bash
gcloud run deploy linebot-file-search \
  --image gcr.io/ä½ çš„å°ˆæ¡ˆID/linebot-file-search \
  --platform managed \
  --region asia-east1 \
  --allow-unauthenticated \
  --set-env-vars ChannelSecret=ä½ çš„SECRET,ChannelAccessToken=ä½ çš„TOKEN,GOOGLE_API_KEY=ä½ çš„API_KEY
```

### æ­¥é©Ÿ 5ï¼šå–å¾—æœå‹™ç¶²å€

```bash
gcloud run services describe linebot-file-search \
  --platform managed \
  --region asia-east1 \
  --format 'value(status.url)'
```

æŠŠé€™å€‹ç¶²å€è¨­å®šåˆ° LINE Bot çš„ Webhook URL å°±å®Œæˆäº†ï¼

## ğŸ”’ å®‰å…¨æ€§å»ºè­°

**ä¸è¦æŠŠæ•æ„Ÿè³‡è¨Šå¯«é€²ç¨‹å¼ç¢¼ï¼** å»ºè­°ä½¿ç”¨ Google Secret Managerï¼š

```bash
# å»ºç«‹ secrets
echo -n "ä½ çš„SECRET" | gcloud secrets create line-channel-secret --data-file=-
echo -n "ä½ çš„TOKEN" | gcloud secrets create line-channel-token --data-file=-
echo -n "ä½ çš„API_KEY" | gcloud secrets create google-api-key --data-file=-
```

éƒ¨ç½²æ™‚ä½¿ç”¨ secretsï¼š

```bash
gcloud run deploy linebot-file-search \
  --image gcr.io/ä½ çš„å°ˆæ¡ˆID/linebot-file-search \
  --platform managed \
  --region asia-east1 \
  --allow-unauthenticated \
  --update-secrets=ChannelSecret=line-channel-secret:latest,ChannelAccessToken=line-channel-token:latest,GOOGLE_API_KEY=google-api-key:latest
```

## ğŸ“Š ç›£æ§èˆ‡é™¤éŒ¯

éƒ¨ç½²å¾Œå¯ä»¥é€é Google Cloud Console ç›£æ§ï¼š

### æŸ¥çœ‹ Logs

```bash
gcloud logging read "resource.type=cloud_run_revision AND resource.labels.service_name=linebot-file-search" --limit 50
```

### æª¢æŸ¥æœå‹™ç‹€æ…‹

ç›´æ¥åˆ° [Cloud Run Console](https://console.cloud.google.com/run) æŸ¥çœ‹æœå‹™ç‹€æ…‹ã€éŒ¯èª¤ç‡ã€å›æ‡‰æ™‚é–“ç­‰æŒ‡æ¨™

## ğŸ’¡ ä½¿ç”¨å°æŠ€å·§

1. **ä¸Šå‚³å¤šä»½æ–‡ä»¶**ï¼šå¯ä»¥é€£çºŒä¸Šå‚³å¤šä»½æ–‡ä»¶ï¼ŒBot æœƒè¨˜ä½æ‰€æœ‰æ–‡ä»¶ä¸¦åœ¨æŸ¥è©¢æ™‚æœå°‹
2. **é‡æ–°é–‹å§‹**ï¼šæƒ³æ¸…ç©ºæ–‡ä»¶åº«ï¼Ÿç›®å‰æª”æ¡ˆæœƒæŒçºŒå„²å­˜åœ¨ Gemini å¾Œç«¯ï¼Œå»ºè­°ç”¨ä¸åŒçš„å°è©±
3. **æ”¯æ´çš„æª”æ¡ˆé¡å‹**ï¼šå–æ±ºæ–¼ Google Gemini File API çš„æ”¯æ´ï¼Œå¤§éƒ¨åˆ†å¸¸è¦‹æ ¼å¼éƒ½å¯ä»¥

## ğŸ¤” å¸¸è¦‹å•é¡Œ

**Q: ç‚ºä»€éº¼æˆ‘å•å•é¡Œæ™‚ Bot èªªã€Œæ‚¨é‚„æ²’æœ‰ä¸Šå‚³ä»»ä½•æª”æ¡ˆã€ï¼Ÿ**
A: è«‹å…ˆä¸Šå‚³è‡³å°‘ä¸€å€‹æª”æ¡ˆæˆ–åœ–ç‰‡ï¼ŒBot æ‰èƒ½æ ¹æ“šå…§å®¹å›ç­”å•é¡Œã€‚

**Q: ç¾¤çµ„èŠå¤©ä¸­ï¼Œå…¶ä»–äººä¸Šå‚³çš„æª”æ¡ˆæˆ‘ä¹Ÿèƒ½æŸ¥è©¢å—ï¼Ÿ**
A: å¯ä»¥ï¼ç¾¤çµ„ä¸­æ‰€æœ‰æˆå“¡å…±äº«åŒä¸€å€‹æ–‡ä»¶åº«ã€‚

**Q: æª”æ¡ˆæœƒä¿å­˜å¤šä¹…ï¼Ÿ**
A: æª”æ¡ˆæœƒæŒçºŒä¿å­˜åœ¨ Google Gemini çš„å¾Œç«¯ï¼Œé™¤éæ‰‹å‹•åˆªé™¤æˆ– store éæœŸã€‚

**Q: æ”¯æ´å“ªäº›èªè¨€ï¼Ÿ**
A: Google Gemini æ”¯æ´å¤šç¨®èªè¨€ï¼ŒåŒ…æ‹¬ç¹é«”ä¸­æ–‡ã€ç°¡é«”ä¸­æ–‡ã€è‹±æ–‡ã€æ—¥æ–‡ç­‰ã€‚

**Q: å¯ä»¥è™•ç†å¤šå¤§çš„æª”æ¡ˆï¼Ÿ**
A: å–æ±ºæ–¼ Google Gemini File API çš„é™åˆ¶ï¼Œä¸€èˆ¬æ–‡ä»¶éƒ½æ²’å•é¡Œã€‚

## ğŸ”§ é€²éšè¨­å®š

### ä¿®æ”¹ AI æ¨¡å‹

åœ¨ `main.py` ç¬¬ 71 è¡Œå¯ä»¥ä¿®æ”¹ä½¿ç”¨çš„æ¨¡å‹ï¼š

```python
MODEL_NAME = "gemini-2.5-flash"  # å¯æ”¹æˆå…¶ä»– Gemini æ¨¡å‹
```

### èª¿æ•´å›æ‡‰æº«åº¦

åœ¨ `main.py` ç¬¬ 177 è¡Œå¯ä»¥èª¿æ•´ AI çš„å‰µæ„ç¨‹åº¦ï¼š

```python
temperature=0.7,  # 0.0 = ä¿å®ˆç²¾ç¢º, 1.0 = å‰µæ„ç™¼æ•£
```

## ğŸ“ æˆæ¬Šæ¢æ¬¾

MIT License - æ­¡è¿è‡ªç”±ä½¿ç”¨ã€ä¿®æ”¹ã€åˆ†äº«ï¼

## ğŸ™Œ è²¢ç»

æ­¡è¿æäº¤ Issue æˆ– Pull Requestï¼

## ğŸ“š ç›¸é—œé€£çµ

- [Google Gemini File Search å®˜æ–¹æ–‡ä»¶](https://ai.google.dev/gemini-api/docs/file-search?hl=zh-tw)
- [LINE Messaging API æ–‡ä»¶](https://developers.line.biz/en/docs/messaging-api/)
- [FastAPI æ–‡ä»¶](https://fastapi.tiangolo.com/)

---

â­ å¦‚æœé€™å€‹å°ˆæ¡ˆå°ä½ æœ‰å¹«åŠ©ï¼Œè«‹çµ¦å€‹ Star æ”¯æŒä¸€ä¸‹ï¼
